# release.yml — stitch-kit automated releases
#
# Uses release-please to automate versioning based on conventional commits.
# How it works:
#   1. Every push to main is analyzed for conventional commits (feat, fix, etc.)
#   2. release-please opens a "Release PR" with the version bump + CHANGELOG update
#   3. When you merge the Release PR, it creates a GitHub release + tag automatically
#
# Version bump rules (from conventional commits):
#   feat:            → minor bump (1.3.0 → 1.4.0)
#   fix: / chore:    → patch bump (1.3.0 → 1.3.1)
#   BREAKING CHANGE: → major bump (1.3.0 → 2.0.0)
#
# Files that get their version bumped automatically:
#   - .claude-plugin/plugin.json      (version field)
#   - .claude-plugin/marketplace.json (metadata.version field)
#
# See release-please-config.json for full configuration.

name: Release

on:
  push:
    branches: [main]

permissions:
  contents: write
  pull-requests: write

jobs:
  release-please:
    name: Create or update release PR
    runs-on: ubuntu-latest
    steps:
      - uses: googleapis/release-please-action@v4
        with:
          release-type: simple
          config-file: release-please-config.json
          manifest-file: .release-please-manifest.json
